extends ../../layouts/default.pug
include ../../mixins/alert.pug

block main 
    +alert-error(3000)
    +alert-success(3000)

    .card.mb-4
        .card-header.py-3.d-flex.flex-row.align-items-center.justify-content-between
            h6.m-0.font-weight-bold.text-primary Chỉnh Sửa Độc Giả
        .card-body
            form#editDocGiaForm(action=`${prefixAdmin}/reader/edit/${docgia.maDG}?_method=PATCH` method="post")
                .row
                    .col-lg-6
                        .form-group
                            label(for="maDG") Mã độc giả
                            input.form-control(type="text" id="maDG" name="maDG" value=`${docgia.maDG}` readonly)
                        .form-group
                            label(for="hoDG") Họ độc giả <span class="required-text">*</span>
                            input.form-control(type="text" id="hoDG" name="hoDG" value=`${docgia.hoDG}` placeholder="Nhập họ độc giả" required)
                            .invalid-feedback#hoDGError Vui lòng nhập họ hợp lệ (chỉ chứa chữ cái).
                        .form-group
                            label(for="tenDG") Tên độc giả <span class="required-text">*</span>
                            input.form-control(type="text" id="tenDG" name="tenDG" value=`${docgia.tenDG}` placeholder="Nhập tên độc giả" required)
                            .invalid-feedback#tenDGError Vui lòng nhập tên hợp lệ (chỉ chứa chữ cái).
                        .form-group
                            label(for="emailDG") Email <span class="required-text">*</span>
                            .input-group.mb-3
                                input.form-control(type="text" id="emailDG" name="emailDG" value=`${docgia.emailDG}` placeholder="Nhập email" required)
                                .input-group-append
                                    span.input-group-text(id="basic-addon2") @gmail.com
                                .invalid-feedback#emailDGError Email chỉ được chứa chữ cái và số, không chứa ký tự đặc biệt.
                        .form-group
                            label(for="soCMND") Số CCCD <span class="required-text">*</span>
                            input.form-control(type="text" id="soCMND" name="soCMND" value=`${docgia.soCMND}` placeholder="Nhập số CCCD" required)
                            .invalid-feedback#soCMNDError Số CCCD phải đúng 12 chữ số.
                        .form-group
                            label(for="gioiTinh") Giới tính <span class="required-text">*</span>
                            select.form-control(id="gioiTinh" name="gioiTinh" required)
                                option(value="true" selected=(docgia.gioiTinh == true)) Nam 
                                option(value="false" selected=(docgia.gioiTinh == false)) Nữ
                            .invalid-feedback#gioiTinhError Vui lòng chọn giới tính.
                    .col-lg-6
                        .form-group
                            label(for="ngaySinh") Ngày sinh <span class="required-text">*</span>
                            input.form-control(type="text" id="ngaySinh" name="ngaySinh" data-ngaySinh=docgia.ngaySinh required)
                            .invalid-feedback#ngaySinhError Ngày sinh không hợp lệ hoặc lớn hơn ngày hiện tại.
                        .form-group
                            label(for="diaChiDG") Địa chỉ <span class="required-text">*</span>
                            input.form-control(type="text" id="diaChiDG" name="diaChiDG" value=`${docgia.diaChiDG}` placeholder="Nhập địa chỉ" required)
                            .invalid-feedback#diaChiDGError Địa chỉ không được chứa ký tự đặc biệt nguy hiểm.
                        .form-group
                            label(for="dienThoai") Số điện thoại <span class="required-text">*</span>
                            input.form-control(type="tel" id="dienThoai" name="dienThoai" value=`${docgia.dienThoai}` placeholder="Nhập số điện thoại" required)
                            .invalid-feedback#dienThoaiError Số điện thoại phải đúng 10 chữ số.
                        .form-group
                            label(for="ngayLamThe") Ngày làm thẻ <span class="required-text">*</span>
                            input.form-control(type="text" id="ngayLamThe" name="ngayLamThe" data-ngayLamThe=docgia.ngayLamThe required)
                            .invalid-feedback#ngayLamTheError Ngày làm thẻ không hợp lệ hoặc nhỏ hơn ngày hiện tại.
                        .form-group
                            label(for="ngayHetHan") Ngày hết hạn <span class="required-text">*</span>
                            input.form-control(type="text" id="ngayHetHan" name="ngayHetHan" data-ngayHetHan=docgia.ngayHetHan required)
                            .invalid-feedback#ngayHetHanError Ngày hết hạn phải lớn hơn ngày làm thẻ.
                        .form-group.d-flex
                            label.mr-4(for="hoatDong") Trạng thái hoạt động <span class="required-text">*</span>
                            .custom-control.custom-switch.ml-4
                                if docgia.hoatDong == true
                                    input.custom-control-input(type="checkbox" name="hoatDong" id="hoatDong" value="true" checked)
                                else
                                    input.custom-control-input(type="checkbox" name="hoatDong" id="hoatDong" value="true")
                                label.custom-control-label(for="hoatDong") Hoạt động
                .d-flex.justify-content-end.mt-3
                    a.btn.btn-secondary.mr-2(href=`${prefixAdmin}/docgia`) Thoát
                    button.btn.btn-primary(type="submit" id="btnLuu") Lưu

    script(src="https://cdn.jsdelivr.net/npm/flatpickr")
    script(src="/vendor/jquery/jquery.min.js")
    script(src="/js/validation.js")
    script(src="/js/adminjs/reader/reader-edit.js")

    script.
        document.addEventListener("DOMContentLoaded", function () {
            // Ngày sinh
            const rawNgaySinhStr = document.querySelector("#ngaySinh").getAttribute("data-ngaySinh"); 
            const ngaySinhObj = new Date(rawNgaySinhStr);
            const day1 = String(ngaySinhObj.getDate()).padStart(2, '0');
            const month1 = String(ngaySinhObj.getMonth() + 1).padStart(2, '0');
            const year1 = ngaySinhObj.getFullYear();
            const ngaySinhFormattedDate = `${day1}/${month1}/${year1}`;

            // Ngày làm thẻ
            const rawNgayLamTheStr = document.querySelector("#ngayLamThe").getAttribute("data-ngayLamThe"); 
            const ngayLamTheObj = new Date(rawNgayLamTheStr);
            const day2 = String(ngayLamTheObj.getDate()).padStart(2, '0');
            const month2 = String(ngayLamTheObj.getMonth() + 1).padStart(2, '0');
            const year2 = ngayLamTheObj.getFullYear();
            const ngayLamTheFormattedDate = `${day2}/${month2}/${year2}`;

            // Ngày hết hạn
            const rawNgayHetHanStr = document.querySelector("#ngayHetHan").getAttribute("data-ngayHetHan"); 
            const ngayHetHanObj = new Date(rawNgayHetHanStr);
            const day3 = String(ngayHetHanObj.getDate()).padStart(2, '0');
            const month3 = String(ngayHetHanObj.getMonth() + 1).padStart(2, '0');
            const year3 = ngayHetHanObj.getFullYear();
            const ngayHetHanFormattedDate = `${day3}/${month3}/${year3}`;

            // Khởi tạo flatpickr
            flatpickr('#ngaySinh', {
                dateFormat: 'd/m/Y',
                allowInput: false,
                maxDate: "today",
                defaultDate: ngaySinhFormattedDate
            });

            flatpickr('#ngayLamThe', {
                dateFormat: 'd/m/Y',
                allowInput: false,
                minDate: "today",
                defaultDate: ngayLamTheFormattedDate
            });

            flatpickr('#ngayHetHan', {
                dateFormat: 'd/m/Y',
                allowInput: false,
                minDate: "today", 
                defaultDate: ngayHetHanFormattedDate
            });
        });
