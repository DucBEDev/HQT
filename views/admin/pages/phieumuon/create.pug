extends ../../layouts/default.pug
include ../../mixins/alert.pug

block main 
    +alert-error(3000)
    +alert-success(3000)

    .container-fluid
        .card.mb-4
            .card-header.py-3.d-flex.flex-row.align-items-center.justify-content-between
                h6.m-0.font-weight-bold.text-primary Tạo Phiếu Mượn
            .card-body
                form#addPhieuMuonForm(action=`${prefixAdmin}/phieumuon/create` method="post")
                    .row
                        .col-lg-12
                            h5 Chọn Sách
                            .row
                                .col-lg-6
                                    .form-group
                                        label(for="sachSearch") Tìm sách
                                        input.form-control(type="text" id="sachSearch" placeholder="Nhập mã sách hoặc tên sách")
                                    .product-list#bookList
                                        each sach in sachList
                                            .product-detail-item(
                                                class=(sach.CHOMUON ? 'disabled' : '')
                                                data-ma-sach=`${sach.MASACH}` 
                                                data-ten-sach=`${sach.TENSACH}` 
                                                data-isbn=`${sach.ISBN}`
                                                data-tinh-trang=`${sach.TINHTRANG}`
                                                style=(sach.CHOMUON ? 'pointer-events: none; opacity: 0.6;' : ''))
                                                    | #{sach.MASACH} - #{sach.TENSACH} #{sach.CHOMUON ? '(Đã được mượn)' : ''}
                                .col-lg-6
                                    .form-group
                                        label Sách đã chọn
                                        .selected-products#selectedBooks
                    hr.separation
                    .row
                        .col-lg-12
                            h5 Thông Tin Phiếu Mượn
                            .form-group
                                label(for="maDG") Mã độc giả <span class="required-text">*</span>
                                input.form-control(type="text" id="maDG" name="maDG" required)
                            .form-group
                                label(for="hinhThuc") Hình thức mượn <span class="required-text">*</span>
                                select.form-control(id="hinhThuc" name="hinhThuc" required)
                                    option(value="1" selected) Mang về
                                    option(value="0") Tại chỗ
                            .form-group
                                label(for="ngayMuon") Ngày mượn <span class="required-text">*</span>
                                input.form-control(type="text" id="ngayMuon" name="ngayMuon" required readonly)
                            .form-group
                                label(for="ngayTra") Ngày trả <span class="required-text">*</span>
                                input.form-control(type="text" id="ngayTra" name="ngayTra" required)
                            .form-group
                                label(for="maNV") Mã nhân viên tạo phiếu <span class="required-text">*</span>
                                input.form-control(type="text" value=`${empName}` readonly)
                                input.form-control(type="text" id="maNV" name="maNV" value=`${empId}` hidden readonly)
                    .row
                        .col-lg-12
                            #selectedBooksInputs
                    .d-flex.justify-content-end.mt-3
                        button.btn.btn-primary(type="submit") Lưu Phiếu Mượn

    script(src="/vendor/jquery/jquery.min.js")
    script(src="https://cdn.jsdelivr.net/npm/fuse.js@7")
    script(src="/js/validation.js")
    script(src="/js/adminjs/phieumuon.js")
    script(src="https://cdn.jsdelivr.net/npm/flatpickr")

    script.
        // Khởi tạo Flatpickr cho ngày mượn
        flatpickr('#ngayMuon', {
            dateFormat: 'd/m/Y', 
            defaultDate: 'today',
            allowInput: false,
            clickOpens: false
        });

        flatpickr('#ngayTra', {
            dateFormat: 'd/m/Y', 
            defaultDate: 'today',
            minDate: 'today',
            maxDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000)
        });
