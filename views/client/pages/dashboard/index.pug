doctype html
html(lang="vi")
    head
        meta(charset="UTF-8")
        meta(name="viewport" content="width=device-width, initial-scale=1.0")
        title Trang chủ - Thư viện
        link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css")
        link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
        style.
            body {
                background-color: #f8f9fa;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            .navbar {
                background: linear-gradient(90deg, #007bff, #00c4b4);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .navbar-brand {
                font-weight: bold;
                color: white !important;
                display: flex;
                align-items: center;
            }
            .navbar-brand img {
                height: 40px;
                margin-right: 10px;
            }
            .card {
                border: none;
                border-radius: 15px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s, box-shadow 0.3s;
                background-color: #fff;
            }
            .card:hover {
                transform: translateY(-10px);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            }
            .card-img-top {
                border-top-left-radius: 15px;
                border-top-right-radius: 15px;
                width: 100%;
                height: 300px; /* Tăng chiều cao để phù hợp với sách dọc */
                object-fit: contain; /* Thay đổi từ 'cover' thành 'contain' để hiển thị toàn bộ bìa sách */
                object-position: center;
                background-color: #f8f9fa; /* Thêm màu nền nhẹ để tạo khung đẹp */
                padding: 10px; /* Thêm padding để tạo khoảng cách */
            }
            .card-body {
                padding: 20px;
            }
            .card-title {
                color: #1a3c6d;
                font-weight: 600;
                font-size: 1.25rem;
                margin-bottom: 10px;
            }
            .card-text {
                color: #555;
                font-size: 0.95rem;
                margin-bottom: 8px;
            }
            .price-badge {
                background-color: #ffc107;
                color: #1a3c6d;
                font-weight: bold;
                padding: 5px 10px;
                border-radius: 12px;
                font-size: 0.9rem;
            }
            .badge-success {
                background-color: #28a745;
                font-size: 0.85rem;
                padding: 5px 10px;
            }
            .badge-danger {
                background-color: #dc3545;
                font-size: 0.85rem;
                padding: 5px 10px;
            }
            .input-group {
                border-radius: 50px;
                overflow: hidden;
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
                background-color: #fff;
            }
            .form-control, .form-select {
                border: none;
                border-radius: 50px;
                padding: 12px 20px;
                font-size: 1rem;
            }
            .form-control:focus, .form-select:focus {
                box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
                border-color: #007bff;
            }
            .btn-primary {
                background: linear-gradient(45deg, #007bff, #00c4b4);
                border: none;
                border-radius: 50px;
                padding: 12px 24px;
                font-size: 1rem;
                transition: background 0.3s;
            }
            .btn-primary:hover {
                background: linear-gradient(45deg, #0056b3, #009688);
            }
            .search-icon {
                margin-right: 8px;
            }
            .footer {
                background-color: #1a3c6d;
                color: white;
                padding: 30px 0;
                margin-top: 50px;
            }
            .footer a {
                color: #00c4b4;
                text-decoration: none;
                transition: color 0.3s;
            }
            .footer a:hover {
                color: #ffffff;
            }
            .pagination-wrapper {
                margin: 40px 0;
                text-align: center;
            }

            .pagination {
                display: inline-flex;
                justify-content: center;
                align-items: center;
                gap: 5px;
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .pagination .page-item {
                margin: 0 2px;
            }

            .pagination .page-link {
                display: block;
                padding: 10px 15px;
                margin: 0;
                color: #007bff;
                text-decoration: none;
                background-color: #fff;
                border: 1px solid #dee2e6;
                border-radius: 50px;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            .pagination .page-link:hover {
                color: #0056b3;
                background-color: #e9ecef;
                border-color: #adb5bd;
                transform: translateY(-2px);
            }

            .pagination .page-item.active .page-link {
                color: #fff;
                background: linear-gradient(45deg, #007bff, #00c4b4);
                border-color: #007bff;
                box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
            }

            .pagination .page-item.disabled .page-link {
                color: #6c757d;
                background-color: #fff;
                border-color: #dee2e6;
                cursor: not-allowed;
                opacity: 0.6;
            }

            .pagination-info {
                color: #6c757d;
                font-size: 0.9rem;
                margin-bottom: 15px;
            }

            @media (max-width: 768px) {
                .pagination .page-link {
                    padding: 8px 12px;
                    font-size: 0.9rem;
                }
                
                .pagination-info {
                    font-size: 0.8rem;
                }
            }
            @media (max-width: 768px) {
                .navbar-brand img {
                    height: 30px;
                }
                .input-group {
                    flex-direction: column;
                }
                .form-control, .btn-primary, .form-select {
                    width: 100%;
                    margin-bottom: 10px;
                    border-radius: 25px;
                }
                .card-img-top {
                    height: 200px;
                }
                .card-title {
                    font-size: 1.1rem;
                }
                .card-text {
                    font-size: 0.9rem;
                }
            }

    body
        // Header
        nav.navbar.navbar-expand-lg.navbar-dark.fixed-top
            .container
                a.navbar-brand(href="/")
                    span Thư viện thông minh
                button.navbar-toggler(type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation")
                    span.navbar-toggler-icon
                #navbarNav.collapse.navbar-collapse
                    ul.navbar-nav.ms-auto
                        li.nav-item
                            a.nav-link.text-white(href="#") Trang chủ
                        li.nav-item
                            a.nav-link.text-white(href="http://localhost:3000/Library/admin/auth/login") Trang quản lý

        // Main content
        .container.py-5.mt-5
            .row.mb-5.align-items-center
                .col-md-8.mb-3.mb-md-0
                    .input-group
                        input.form-control(type="search" placeholder="Tìm kiếm sách..." id="searchInput")
                        button.btn.btn-primary(type="button")
                            i.fas.fa-search.search-icon
                            | Tìm kiếm

            .row#booksList
                each book in books || []
                    .col-md-4.col-sm-6.mb-4.detail-book(data-id=book.ISBN)
                        .card.h-100
                            img.card-img-top(src=book.HINHANHPATH alt=book.TENSACH)
                            .card-body
                                h5.card-title= book.TENSACH
                                if book.TENTACGIA
                                    p.card-text
                                        i.fas.fa-user-pen.me-2
                                        strong Tác giả: 
                                        span= book.TENTACGIA
                                if book.NHAXB
                                    p.card-text
                                        i.fas.fa-building.me-2
                                        strong Nhà xuất bản: 
                                        span= book.NHAXB
                                if book.GIA
                                    p.card-text
                                        i.fas.fa-tag.me-2
                                        strong Giá: 
                                        - const price = book.GIA.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                                        span.price-badge= price + ' ₫'
                                if book.SOLUONGCHOMUON > 0
                                    p.card-text
                                        span.badge.badge-success Còn #{book.SOLUONGCHOMUON} sách
                                else
                                    p.card-text
                                        span.badge.badge-danger Hết sách

            // Pagination
            .pagination-wrapper
                .pagination-info
                    span#paginationInfo
                nav(aria-label="Phân trang sách")
                    ul.pagination
                        li.page-item#prevPage
                            a.page-link(href="#" aria-label="Trang trước")
                                i.fas.fa-chevron-left
                        li.page-item#nextPage
                            a.page-link(href="#" aria-label="Trang sau")
                                i.fas.fa-chevron-right

        // Footer
        footer.footer.text-center
            .container
                p.mb-2 &copy; 2025 Thư viện thông minh. All rights reserved.
                p.mb-1
                    a(href="/privacy") Chính sách bảo mật
                    |  | 
                    a(href="/terms") Điều khoản sử dụng
                p
                    | Liên hệ: 
                    a(href="mailto:support@library.com") support@library.com

        form(
            action=""
            id="form-detail-book"
        )

        script(src="/vendor/jquery/jquery.min.js")
        script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js")
        script.
            document.addEventListener('DOMContentLoaded', function() {
                const searchInput = document.getElementById('searchInput');
                const booksList = document.getElementById('booksList');
                const paginationInfo = document.getElementById('paginationInfo');
                const pagination = document.querySelector('.pagination');
                const prevPage = document.getElementById('prevPage');
                const nextPage = document.getElementById('nextPage');
                
                let currentPage = 1;
                let booksPerPage = 6; // Số sách mỗi trang
                let filteredBooks = [];
                let allBooks = [];
                
                // Lấy tất cả sách từ DOM
                function initializeBooks() {
                    allBooks = Array.from(document.querySelectorAll('.detail-book'));
                    filteredBooks = [...allBooks];
                    showPage(1);
                }
                
                // Tìm kiếm sách
                function performSearch() {
                    const searchTerm = searchInput.value.toLowerCase().trim();
                    
                    if (searchTerm === '') {
                        filteredBooks = [...allBooks];
                    } else {
                        filteredBooks = allBooks.filter(card => {
                            const title = card.querySelector('.card-title').textContent.toLowerCase();
                            return title.includes(searchTerm);
                        });
                    }
                    
                    currentPage = 1;
                    showPage(1);
                }
                
                // Hiển thị trang
                function showPage(page) {
                    currentPage = page;
                    const totalBooks = filteredBooks.length;
                    const totalPages = Math.ceil(totalBooks / booksPerPage);
                    
                    // Ẩn tất cả sách
                    allBooks.forEach(book => book.style.display = 'none');
                    
                    // Hiển thị sách của trang hiện tại
                    const startIndex = (page - 1) * booksPerPage;
                    const endIndex = startIndex + booksPerPage;
                    const booksToShow = filteredBooks.slice(startIndex, endIndex);
                    
                    booksToShow.forEach(book => book.style.display = 'block');
                    
                    // Cập nhật thông tin phân trang
                    updatePaginationInfo(totalBooks, startIndex, endIndex);
                    
                    // Cập nhật các nút phân trang
                    updatePaginationButtons(totalPages);
                }
                
                // Cập nhật thông tin phân trang
                function updatePaginationInfo(totalBooks, startIndex, endIndex) {
                    if (totalBooks === 0) {
                        paginationInfo.textContent = 'Không tìm thấy sách nào';
                    } else {
                        const actualEndIndex = Math.min(endIndex, totalBooks);
                        paginationInfo.textContent = `Hiển thị ${startIndex + 1}-${actualEndIndex} trong tổng số ${totalBooks} cuốn sách`;
                    }
                }
                
                // Cập nhật các nút phân trang
                function updatePaginationButtons(totalPages) {
                    // Xóa các nút trang cũ
                    const existingPageButtons = pagination.querySelectorAll('.page-item:not(#prevPage, #nextPage)');
                    existingPageButtons.forEach(button => button.remove());
                    
                    // Cập nhật nút Previous
                    prevPage.classList.toggle('disabled', currentPage === 1);
                    
                    // Cập nhật nút Next
                    nextPage.classList.toggle('disabled', currentPage === totalPages || totalPages === 0);
                    
                    // Tạo các nút trang
                    if (totalPages > 0) {
                        const maxVisiblePages = 5;
                        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
                        
                        if (endPage - startPage + 1 < maxVisiblePages) {
                            startPage = Math.max(1, endPage - maxVisiblePages + 1);
                        }
                        
                        for (let i = startPage; i <= endPage; i++) {
                            const pageItem = document.createElement('li');
                            pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                            
                            const pageLink = document.createElement('a');
                            pageLink.className = 'page-link';
                            pageLink.href = '#';
                            pageLink.textContent = i;
                            pageLink.addEventListener('click', function(e) {
                                e.preventDefault();
                                showPage(i);
                            });
                            
                            pageItem.appendChild(pageLink);
                            nextPage.parentNode.insertBefore(pageItem, nextPage);
                        }
                    }
                }
                
                // Event listeners
                searchInput.addEventListener('input', performSearch);
                document.querySelector('.btn-primary').addEventListener('click', performSearch);
                
                // Event listeners cho Previous/Next
                prevPage.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (currentPage > 1) {
                        showPage(currentPage - 1);
                    }
                });
                
                nextPage.addEventListener('click', function(e) {
                    e.preventDefault();
                    const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
                    if (currentPage < totalPages) {
                        showPage(currentPage + 1);
                    }
                });
                
                // Khởi tạo
                initializeBooks();
            });

            $(document).ready(function () {
                $('.detail-book').on('click', function() {
                    const id = $(this).data('id')
                    $('#form-detail-book').attr('action', `/Library/dashboard/detail/${id}`)
                    $('#form-detail-book').submit()
                })
            });